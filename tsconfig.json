{
  "menu": {
    "title": "Men√∫ principal",
    "message": {
      "body": "Selecciona una opci√≥n:",
      "type": "buttons",
      "buttons": [
        {
          "id": "menu_agendar",
          "title": "Agendar cita"
        },
        {
          "id": "menu_resultados",
          "title": "Resultados"
        }
      ]
    },
    "options": [
      {
        "id": "menu_agendar",
        "title": "Agendar cita",
        "actions": [
          {
            "type": "send_message",
            "message": {
              "body": "Estamos listos para agendar tu cita.",
              "type": "text"
            }
          }
        ],
        "keywords": [
          "agendar",
          "cita"
        ]
      }
    ]
  },
  "entry": {
    "title": "Men√∫ principal",
    "keywords": [
      "menu",
      "inicio",
      "hola",
      "buen dia",
      "buenos dias",
      "buenas tardes",
      "buenas noches",
      "start"
    ],
    "messages": [
      {
        "body": "Selecciona una opci√≥n:",
        "type": "buttons",
        "buttons": [
          {
            "id": "menu_agendar",
            "title": "Agendar cita"
          },
          {
            "id": "menu_resultados",
            "title": "Resultados"
          }
        ]
      }
    ],
    "description": "Primer contacto que recibe toda persona que escribe al canal."
  },
  "consent": {
    "buttons": {
      "accept": "S√≠, autorizo",
      "decline": "No, gracias"
    },
    "intro_lines": [
      "Por favor, antes de continuar, ay√∫danos con unos datos.",
      "Para continuar con la conversaci√≥n, debes aceptar nuestros T√©rminos, Condiciones y Aviso de Privacidad: üëâ {{terms_url}}",
      "¬øContinuamos?"
    ],
    "consent_retry": "Necesitamos tu confirmaci√≥n para continuar. Usa los botones enviados o responde \"s√≠, autorizo\" si est√°s de acuerdo.",
    "consent_prompt": "Confirmamos tu identidad y protegemos tus datos personales para brindarte un mejor servicio en Cl√≠nica Internacional de la Visi√≥n del Ecuador. ¬øAutorizas el uso de tu informaci√≥n para gestionar tus servicios m√©dicos?",
    "consent_declined": "Entendido. No utilizaremos tus datos hasta que lo autorices. Si deseas continuar responde \"s√≠\" o comun√≠cate con nuestro equipo.",
    "identifier_retry": "No encontramos tu registro con el n√∫mero de historia cl√≠nica proporcionado. Verif√≠calo y vuelve a intentarlo.",
    "confirmation_menu": "Cuando confirmes la informaci√≥n, responde con la opci√≥n que necesites o escribe \"menu\" para ver las alternativas disponibles.",
    "confirmation_check": "¬øEst√° seguro de que la informaci√≥n ingresada es correcta? ‚úÖ",
    "identifier_request": "Escribe tu n√∫mero de historia cl√≠nica ü™™",
    "confirmation_review": "Por favor, verifica si tu n√∫mero de historia cl√≠nica {{history_number}} est√° correcto antes de continuar. ¬°Gracias por tu atenci√≥n! üòä",
    "confirmation_recorded": "Tu autorizaci√≥n qued√≥ registrada en nuestro sistema. Continuemos con la atenci√≥n. ‚úÖ"
  },
  "options": [
    {
      "id": "information",
      "title": "Opci√≥n 1 ¬∑ Obtener informaci√≥n",
      "followup": "Sugiere escribir 'horarios' para continuar o 'menu' para volver al inicio.",
      "keywords": [
        "1",
        "opcion 1",
        "informacion",
        "informacion general",
        "obtener informacion",
        "informacion cive"
      ],
      "messages": [
        {
          "body": "Obtener Informaci√≥n",
          "type": "text"
        },
        {
          "body": "Selecciona la informaci√≥n que deseas conocer:\n‚Ä¢ Procedimientos oftalmol√≥gicos disponibles.\n‚Ä¢ Servicios complementarios como √≥ptica y ex√°menes especializados.\n‚Ä¢ Seguros y convenios con los que trabajamos.\n\nEscribe 'horarios' para conocer los horarios de atenci√≥n o 'menu' para volver al inicio.",
          "type": "text"
        }
      ],
      "description": "Respuestas que se disparan con las palabras clave listadas."
    },
    {
      "id": "schedule",
      "title": "Opci√≥n 2 ¬∑ Horarios de atenci√≥n",
      "followup": "Indica que el usuario puede responder 'menu' para otras opciones.",
      "keywords": [
        "2",
        "opcion 2",
        "horarios",
        "horario",
        "horario atencion",
        "horarios atencion",
        "horarios de atencion"
      ],
      "messages": [
        {
          "body": "Horarios de atenci√≥n üïñ\nVilla Club: Lunes a Viernes 09h00 - 18h00, S√°bados 09h00 - 13h00.\nCeibos: Lunes a Viernes 09h00 - 18h00, S√°bados 09h00 - 13h00.\n\nSi necesitas otra informaci√≥n responde 'menu'.",
          "type": "text"
        }
      ],
      "description": "Horarios disponibles para cada sede."
    },
    {
      "id": "locations",
      "title": "Opci√≥n 3 ¬∑ Ubicaciones",
      "followup": "Recomienda escribir 'horarios' o 'menu' seg√∫n la necesidad.",
      "keywords": [
        "3",
        "opcion 3",
        "ubicacion",
        "ubicaciones",
        "sedes",
        "direccion",
        "direcciones"
      ],
      "messages": [
        {
          "body": "Nuestras sedes üìç\nVilla Club: Km. 12.5 Av. Le√≥n Febres Cordero, Villa Club Etapa Flora.\nCeibos: C.C. Ceibos Center, piso 2, consultorio 210.\n\nResponde 'horarios' para conocer los horarios o 'menu' para otras opciones.",
          "type": "text"
        }
      ],
      "description": "Direcciones de las sedes disponibles."
    },
    {
      "id": "menu_agendar",
      "title": "Agendar cita",
      "followup": "",
      "keywords": [
        "agendar",
        "cita"
      ],
      "messages": [
        {
          "body": "Estamos listos para agendar tu cita.",
          "type": "text"
        }
      ],
      "description": ""
    }
  ],
  "fallback": {
    "title": "Sin coincidencia",
    "keywords": [],
    "messages": [
      {
        "body": "No logr√© identificar tu solicitud. Responde 'menu' para ver las opciones disponibles o 'horarios' para conocer nuestros horarios de atenci√≥n.",
        "type": "text"
      }
    ],
    "description": "Mensaje que se env√≠a cuando ninguna palabra clave coincide."
  },
  "scenarios": [
    {
      "id": "primer_contacto",
      "name": "Primer contacto",
      "stage": "arrival",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "¬°Hola! Soy el asistente virtual de MedForge üëÅÔ∏è. Te acompa√±ar√© durante todo tu proceso.",
            "type": "text"
          }
        },
        {
          "type": "send_buttons",
          "message": {
            "body": "¬øNos autorizas a usar tus datos protegidos para brindarte atenci√≥n?",
            "type": "buttons",
            "buttons": [
              {
                "id": "acepto",
                "title": "Acepto"
              },
              {
                "id": "no_acepto",
                "title": "No acepto"
              }
            ]
          }
        },
        {
          "type": "set_state",
          "state": "consentimiento_pendiente"
        }
      ],
      "stageId": "arrival",
      "stage_id": "arrival",
      "conditions": [
        {
          "type": "always"
        }
      ],
      "description": "Da la bienvenida, solicita el consentimiento y explica los siguientes pasos.",
      "intercept_menu": true
    },
    {
      "id": "captura_cedula",
      "name": "Captura de consentimiento",
      "stage": "validation",
      "actions": [
        {
          "type": "store_consent",
          "value": true
        },
        {
          "type": "send_message",
          "message": {
            "body": "Gracias. Por favor, escribe tu n√∫mero de historia cl√≠nica o c√©dula.",
            "type": "text"
          }
        },
        {
          "type": "set_state",
          "state": "esperando_cedula"
        },
        {
          "type": "set_context",
          "values": {
            "awaiting_field": "cedula"
          }
        }
      ],
      "stageId": "validation",
      "stage_id": "validation",
      "conditions": [
        {
          "type": "state_is",
          "value": "consentimiento_pendiente"
        },
        {
          "type": "message_in",
          "values": [
            "acepto",
            "si",
            "s√≠"
          ]
        }
      ],
      "description": "Registra la autorizaci√≥n y solicita el identificador del paciente.",
      "intercept_menu": true
    },
    {
      "id": "validar_cedula",
      "name": "Validar c√©dula",
      "stage": "validation",
      "actions": [
        {
          "type": "lookup_patient",
          "field": "cedula",
          "source": "message"
        },
        {
          "else": [
            {
              "type": "upsert_patient_from_context"
            },
            {
              "type": "send_message",
              "message": {
                "body": "Registr√© tus datos para avanzar. ¬øDeseas que te muestre las opciones disponibles?",
                "type": "text"
              }
            },
            {
              "type": "set_state",
              "state": "menu_principal"
            },
            {
              "type": "goto_menu"
            }
          ],
          "then": [
            {
              "type": "send_message",
              "message": {
                "body": "Hola {{context.patient.full_name}} üëã. Ya podemos continuar con tu atenci√≥n.",
                "type": "text"
              }
            },
            {
              "type": "set_state",
              "state": "menu_principal"
            },
            {
              "type": "goto_menu"
            }
          ],
          "type": "conditional",
          "condition": {
            "type": "patient_found",
            "value": true
          }
        }
      ],
      "stageId": "validation",
      "stage_id": "validation",
      "conditions": [
        {
          "type": "state_is",
          "value": "esperando_cedula"
        },
        {
          "type": "message_matches",
          "pattern": "^\\d{6,10}$"
        }
      ],
      "description": "Valida el identificador ingresado y redirige al men√∫ correspondiente.",
      "intercept_menu": true
    },
    {
      "id": "retorno",
      "name": "Retorno conocido",
      "stage": "arrival",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "Hola {{context.patient.full_name}} üëã, ¬øen qu√© puedo ayudarte hoy?",
            "type": "text"
          }
        },
        {
          "type": "goto_menu"
        }
      ],
      "stageId": "arrival",
      "stage_id": "arrival",
      "conditions": [
        {
          "type": "is_first_time",
          "value": false
        },
        {
          "type": "has_consent",
          "value": true
        }
      ],
      "description": "Saluda nuevamente a contactos con consentimiento registrado.",
      "intercept_menu": true
    },
    {
      "id": "acceso_menu_directo",
      "name": "Acceso directo al men√∫",
      "stage": "menu",
      "actions": [
        {
          "type": "set_state",
          "state": "menu_principal"
        },
        {
          "type": "goto_menu"
        }
      ],
      "stageId": "menu",
      "stage_id": "menu",
      "conditions": [
        {
          "type": "has_consent",
          "value": true
        },
        {
          "type": "message_in",
          "values": [
            "menu",
            "inicio",
            "hola",
            "buen dia",
            "buenos dias",
            "buenas tardes",
            "buenas noches",
            "start"
          ]
        }
      ],
      "description": "Permite abrir el men√∫ cuando ya existe consentimiento registrado.",
      "intercept_menu": true
    },
    {
      "id": "menu_principal",
      "name": "Ir al men√∫ principal",
      "stage": "menu",
      "actions": [
        {
          "type": "goto_menu"
        }
      ],
      "stageId": "menu",
      "stage_id": "menu",
      "conditions": [
        {
          "type": "message_contains",
          "keywords": [
            "menu",
            "men√∫",
            "opciones",
            "volver"
          ]
        }
      ],
      "description": "Permite acceder nuevamente al men√∫ principal de opciones.",
      "intercept_menu": false
    },
    {
      "id": "agendamiento",
      "name": "Inter√©s en agendar cita",
      "stage": "scheduling",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "Con gusto te ayudo a agendar. Ind√≠came la fecha y hora que prefieres o si deseas que te proponga opciones.",
            "type": "text"
          }
        }
      ],
      "stageId": "scheduling",
      "stage_id": "scheduling",
      "conditions": [
        {
          "type": "message_contains",
          "keywords": [
            "agendar",
            "cita",
            "reagendar",
            "reservar"
          ]
        }
      ],
      "description": "Gu√≠a al paciente para reservar o reagendar una cita.",
      "intercept_menu": false
    },
    {
      "id": "entrega_resultados",
      "name": "Consultar resultados",
      "stage": "results",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "Para compartir tus resultados necesito validar tu identidad. Por favor confirma tu n√∫mero de identificaci√≥n.",
            "type": "text"
          }
        }
      ],
      "stageId": "results",
      "stage_id": "results",
      "conditions": [
        {
          "type": "message_contains",
          "keywords": [
            "resultado",
            "resultados",
            "examen",
            "laboratorio"
          ]
        }
      ],
      "description": "Responde cuando el paciente quiere conocer sus resultados de laboratorio.",
      "intercept_menu": false
    },
    {
      "id": "post_consulta",
      "name": "Seguimiento post consulta",
      "stage": "post",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "Gracias por confiar en nosotros. ¬øDeseas reagendar, recibir recomendaciones o calificar tu experiencia?",
            "type": "text"
          }
        }
      ],
      "stageId": "post",
      "stage_id": "post",
      "conditions": [
        {
          "type": "message_contains",
          "keywords": [
            "gracias",
            "seguimiento",
            "control",
            "post consulta"
          ]
        }
      ],
      "description": "Env√≠a recomendaciones o recordatorios despu√©s de la atenci√≥n m√©dica.",
      "intercept_menu": false
    },
    {
      "id": "fallback",
      "name": "Fallback",
      "stage": "custom",
      "actions": [
        {
          "type": "send_message",
          "message": {
            "body": "No te entend√≠. Escribe men√∫ para ver opciones.",
            "type": "text"
          }
        }
      ],
      "stageId": "custom",
      "stage_id": "custom",
      "conditions": [
        {
          "type": "always"
        }
      ],
      "description": "Cuando ninguna regla aplica.",
      "intercept_menu": false
    }
  ],
  "variables": {
    "cedula": {
      "label": "C√©dula",
      "source": "context.cedula",
      "persist": true
    },
    "estado": {
      "label": "Estado",
      "source": "context.state",
      "persist": false
    },
    "nombre": {
      "label": "Nombre completo",
      "source": "patient.full_name",
      "persist": false
    },
    "telefono": {
      "label": "Tel√©fono",
      "source": "session.wa_number",
      "persist": true
    },
    "consentimiento": {
      "label": "Consentimiento",
      "source": "context.consent",
      "persist": true
    }
  }
}